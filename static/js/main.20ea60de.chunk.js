(this.webpackJsonpbonus_cards=this.webpackJsonpbonus_cards||[]).push([[0],{213:function(e,t,n){e.exports=n.p+"static/media/barcode_how.f8d6a335.png"},219:function(e){e.exports=JSON.parse('{"name":"bonus_cards","version":"1.3.18","description":"","main":"index.js","homepage":"https://nikitazhelonkin.github.io/BonusCards/","scripts":{"predeploy":"npm run build","deploy":"gh-pages -d build","start":"cross-env PORT=10888 react-scripts start","build":"react-scripts build"},"keywords":[],"author":"","license":"MIT","devDependencies":{"cross-env":"^5.2.1","react-hot-loader":"^4.12.18","react-scripts":"^3.2.0"},"dependencies":{"@storeon/localstorage":"^0.6.3","@vkontakte/icons":"^1.11.4","@vkontakte/vk-connect":"^1.6.11","@vkontakte/vk-mini-apps-api":"^0.2.0","@vkontakte/vkui":"^2.33.3","babel-eslint":"^10.0.3","chalk":"^2.4.2","core-js":"^3.4.4","cyrillic-to-translit-js":"^3.0.1","firebase":"^7.5.2","gh-pages":"^2.1.1","msgpack":"^1.0.3","msgpack-lite":"^0.1.26","prop-types":"^15.7.2","react":"^16.12.0","react-barcode":"^1.4.0","react-barcode-reader":"0.0.1","react-detect-offline":"^2.4.0","react-dom":"^16.12.0","react-router5":"^7.1.0","react-virtualized":"^9.21.2","router5":"^7.0.2","router5-history":"^3.0.4","router5-plugin-browser":"^7.0.2","router5-plugin-logger":"^7.0.2","storeon":"^0.8.7"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},270:function(e,t,n){e.exports=n(462)},462:function(e,t,n){"use strict";n.r(t);n(271),n(298),n(300),n(301),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340);var a=n(0),r=n.n(a),c=n(30),o=n.n(c),l=n(34),i=n.n(l),s=n(144),u=n.n(s),d=n(196),m=n(65),h=n(70),p=n.n(h),f=n(4),g=n(64),v=n.n(g),E=n(108),b=(n(360),n(71)),y=n(72),k=n(77),w=n(74),C=n(73),j=n(78),O=n(209),x=n.n(O),S=n(75),_=n.n(S),I=n(109),A=n.n(I),B=(n(99),function(e){function t(e){var n;return Object(b.a)(this,t),(n=Object(k.a)(this,Object(w.a)(t).call(this,e))).state={search:"",services:[]},n.onChange=n.onChange.bind(Object(C.a)(n)),n}return Object(j.a)(t,e),Object(y.a)(t,[{key:"onChange",value:function(e){this.setState({search:e})}},{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({services:t.data.all})}))}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.router;return r.a.createElement(f.r,{id:t},r.a.createElement(f.s,{noShadow:!0},"\u0411\u043e\u043d\u0443\u0441 \u043a\u0430\u0440\u0442\u044b"),r.a.createElement(f.g,{vertical:"top"},r.a.createElement(f.v,{value:this.state.search,onChange:this.onChange,theme:"default"})),0===this.cards.length&&0===this.state.search.length?r.a.createElement("div",null,r.a.createElement("div",{style:{height:52}}),r.a.createElement(f.t,{icon:r.a.createElement(v.a,null)},"\u0412\u044b \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u043d\u0438 \u043e\u0434\u043d\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438")):0===this.cards.length&&r.a.createElement("div",null,r.a.createElement("div",{style:{height:52}}),r.a.createElement(f.t,{icon:r.a.createElement(v.a,null)},"\u041f\u043e \u0412\u0430\u0448\u0435\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")),r.a.createElement(f.o,{style:{paddingTop:60,marginBottom:60}},this.cards.map((function(e){return r.a.createElement(f.e,{before:"undefined"!==typeof e.logo&&null!=e.logo?r.a.createElement(f.c,{type:"image",src:"/BonusCards"+e.logo,style:{background:e.bgColor}}):r.a.createElement(f.c,{type:"image"},r.a.createElement(_.a,null)),multiline:!0,expandable:!0,removable:!1,key:e.id,onClick:function(){return n.navigate("card",{id:e.id})},description:e.number},e.name)}))),r.a.createElement(f.g,{vertical:"bottom"},Object(f.A)()===f.a?r.a.createElement(f.f,{style:{float:"right"}},r.a.createElement(f.d,{className:"FixedBottomButton",onClick:function(){return n.navigate("services")}},r.a.createElement(x.a,null))):r.a.createElement(f.f,null,r.a.createElement(f.d,{size:"xl",onClick:function(){return n.navigate("services")}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u043a\u0430\u0440\u0442\u0443"))))}},{key:"cards",get:function(){var e=this,t=this.props.cards.data,n=this.state.search.toLowerCase().trim(),a=A()().transform(n);return t.filter((function(e){var t=e.name;return t.toLowerCase().indexOf(n)>-1||t.toLowerCase().indexOf(a)>-1})).map((function(t){var n=e.state.services.filter((function(e){return e.id===t.serviceId}))[0];return{id:t.id,name:t.name,number:t.number,logo:null!=n?n.logo:null,bgColor:null!=n?n.bgColor:null}}))}}]),t}(r.a.Component)),z=p()("cards",B),R=n(76),M=n.n(R),V=n(54),T=n.n(V),P=n(210),W=n.n(P),N=n(211),U=n.n(N),H=n(212),L=n.n(H),K=n(141),D=n.n(K),J=Object(f.A)(),q=function(e){var t=D()("cards"),n=t.dispatch,c=t.cards,o=Object(a.useState)(null),l=Object(m.a)(o,2),s=l[0],u=l[1],d=c.data.filter((function(t){return t.id===e.route.params.id}))[0],h=function(){e.setPopout(null)};return r.a.createElement(f.r,{id:e.id},r.a.createElement(f.s,{left:r.a.createElement(f.l,{onClick:function(){return window.history.back()}},J===f.m?r.a.createElement(M.a,null):r.a.createElement(T.a,null))},"undefined"!==typeof d?d.name:"\u0423\u043f\u0441"),"undefined"!==typeof d&&r.a.createElement("div",null,r.a.createElement(f.j,null,r.a.createElement("div",{className:"BarcodeContainer",onClick:function(){u(!0),i.a.send("VKWebAppCopyText",{text:d.number})}},r.a.createElement("div",{className:"Barcode"},r.a.createElement(L.a,{value:d.number.toString(),displayValue:!0,fontSize:25,height:120})))),r.a.createElement(f.h,{className:"unselectable"},"\u041f\u0440\u0435\u0434\u044a\u044f\u0432\u0438\u0442\u0435 \u044d\u0442\u043e\u0442 \u043a\u043e\u0434 \u043d\u0430 \u043a\u0430\u0441\u0441\u0435 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0430"),r.a.createElement(f.f,{style:{display:"flex"}},r.a.createElement(f.d,{before:r.a.createElement(U.a,null),size:"l",stretched:!0,level:"secondary",onClick:function(){var e="https://vk.com/app7225850#add_name="+encodeURIComponent(d.name)+"&add_service_id="+d.serviceId+"&add_number="+d.number;console.log(e),i.a.send("VKWebAppShare",{link:e})},style:{marginRight:8}},"\u041f\u043e\u0434\u0435\u043b\u0438\u0442\u044c\u0441\u044f"),r.a.createElement(f.d,{before:r.a.createElement(W.a,null),size:"l",stretched:!0,level:"destructive",onClick:function(){e.setPopout(r.a.createElement(f.b,{actionsLayout:"vertical",onClose:h,actions:[{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",false:!0,style:"destructive",action:function(){h(),window.history.back(),n("cards/api/delete",d)}},{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,style:"cancel"}]},r.a.createElement("h2",null,"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"),r.a.createElement("p",null,"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435",r.a.createElement("br",null),"\u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0443 ",d.name,"?")))}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))),"undefined"===typeof d&&r.a.createElement(f.t,{icon:r.a.createElement(v.a,null)},"\u0422\u0430\u043a\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0435\u0442, \u043b\u0438\u0431\u043e \u043e\u043d\u0430 \u0431\u044b\u043b\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0430"),s&&r.a.createElement(f.w,{layout:"vertical",onClose:function(){return u(!1)}},"\u041d\u043e\u043c\u0435\u0440 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430"))};function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function G(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Q=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M80,48H16C7.168,48,0,55.168,0,64v64c0,8.832,7.168,16,16,16c8.832,0,16-7.168,16-16V80h48c8.832,0,16-7.168,16-16 C96,55.168,88.832,48,80,48z"}))),X=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M464,336c-8.832,0-16,7.168-16,16v48h-48c-8.832,0-16,7.168-16,16c0,8.832,7.168,16,16,16h64c8.832,0,16-7.168,16-16v-64 C480,343.168,472.832,336,464,336z"}))),Y=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M464,48h-64c-8.832,0-16,7.168-16,16c0,8.832,7.168,16,16,16h48v48c0,8.832,7.168,16,16,16c8.832,0,16-7.168,16-16V64 C480,55.168,472.832,48,464,48z"}))),Z=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M80,400H32v-48c0-8.832-7.168-16-16-16c-8.832,0-16,7.168-16,16v64c0,8.832,7.168,16,16,16h64c8.832,0,16-7.168,16-16 C96,407.168,88.832,400,80,400z"}))),$=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:64,y:112,width:32,height:256}))),ee=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:128,y:112,width:32,height:192}))),te=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:192,y:112,width:32,height:192}))),ne=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:256,y:112,width:32,height:256}))),ae=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:320,y:112,width:32,height:192}))),re=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:384,y:112,width:32,height:256}))),ce=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:128,y:336,width:32,height:32}))),oe=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:192,y:336,width:32,height:32}))),le=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:320,y:336,width:32,height:32}))),ie=r.a.createElement("g",null),se=r.a.createElement("g",null),ue=r.a.createElement("g",null),de=r.a.createElement("g",null),me=r.a.createElement("g",null),he=r.a.createElement("g",null),pe=r.a.createElement("g",null),fe=r.a.createElement("g",null),ge=r.a.createElement("g",null),ve=r.a.createElement("g",null),Ee=r.a.createElement("g",null),be=r.a.createElement("g",null),ye=r.a.createElement("g",null),ke=r.a.createElement("g",null),we=r.a.createElement("g",null),Ce=function(e){var t=e.svgRef,n=e.title,a=G(e,["svgRef","title"]);return r.a.createElement("svg",F({id:"Capa_1",x:"0px",y:"0px",viewBox:"0 0 480 480",style:{enableBackground:"new 0 0 480 480"},xmlSpace:"preserve",ref:t},a),n?r.a.createElement("title",null,n):null,Q,X,Y,Z,$,ee,te,ne,ae,re,ce,oe,le,ie,se,ue,de,me,he,pe,fe,ge,ve,Ee,be,ye,ke,we)},je=r.a.forwardRef((function(e,t){return r.a.createElement(Ce,F({svgRef:t},e))})),Oe=(n.p,n(213)),xe=n.n(Oe),Se=function(e){function t(e){var n;Object(b.a)(this,t),(n=Object(k.a)(this,Object(w.a)(t).call(this,e))).onTooltipClose=function(){n.props.dispatch("prefs/set",{key:"scan_tooltip_shown",value:!0}),n.setState({tooltip:!1})},n.onDone=function(e){n.setState({number:e.qr_data,error:!1})},n.onError=function(e){},n.onScanClick=function(e){!0!==n.props.prefs.scan_ios_tooltip_shown&&f.A===f.m?n.props.setModal(r.a.createElement(f.q,{activeModal:"modal"},r.a.createElement(f.p,{id:"modal",onClose:function(){return n.props.setModal(null)},icon:r.a.createElement(f.c,{type:"app",src:xe.a,size:72}),title:"\u0427\u0442\u043e\u0431\u044b \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u043d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u043d\u0430 \u043d\u0438\u0436\u043d\u044e\u044e \u0447\u0430\u0441\u0442\u044c \u0440\u0430\u043c\u043a\u0438",caption:"\u041d\u0430\u0439\u0434\u0438\u0442\u0435 \u0445\u043e\u0440\u043e\u0448\u0435\u0435 \u043e\u0441\u0432\u0435\u0449\u0435\u043d\u0438\u0435",actions:[{title:"\u0411\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c",type:"secondary",action:function(){n.props.dispatch("prefs/set",{key:"scan_ios_tooltip_shown",value:!0}),n.props.setModal(null),n.scan(e)}},{title:"\u041f\u043e\u043d\u044f\u043b",type:"primary",action:function(){n.props.setModal(null),n.scan(e)}}]}))):n.scan(e)},n.scan=function(e){i.a.sendPromise("VKWebAppOpenQR").then(n.onDone).catch(n.onError)},n.goBack=function(){window.history.back()},n.goHome=function(){n.props.router.navigate("home",{},{replace:!0})},n.onAddClick=function(){var e=n.state,t=e.name,a=e.number;if(n.isValidName(t)&&n.isValidCard(a)){n.setState({error:!1});var r=n.state.serviceId,c=n.props.user.uid;console.log("user#2:"+n.props.user),n.props.dispatch("cards/api/add",{uid:c,name:t,number:a,serviceId:r}),n.goHome()}else n.setState({error:!0})},n.onChangeText=function(e){var t=e.target.value.trim().substring(0,24).replace(/[^\x00-\x7F]/g,"");n.setState({number:t,error:!n.isValidCard(t)})};var a=e.route.params.number||"";return n.state={tooltip:!0!==e.prefs.scan_tooltip_shown,serviceId:e.route.params.serviceid,name:decodeURIComponent(e.route.params.name),number:a,error:!n.isValidCard(a),service:null},n}return Object(j.a)(t,e),Object(y.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({service:t.data.all.filter((function(t){return t.id===e.state.serviceId}))[0]})}))}},{key:"isValidName",value:function(e){return""!==e}},{key:"isValidCard",value:function(e){return console.log(e),null!=e&&e.match("^[\0-\x7f]{6,24}$")}},{key:"render",value:function(){var e=this,t=Object(f.A)();return r.a.createElement(f.r,{id:this.props.id},r.a.createElement(f.s,{left:r.a.createElement(f.l,{onClick:function(){return e.goBack()}},t===f.m?r.a.createElement(M.a,null):r.a.createElement(T.a,null))},"\u041d\u043e\u0432\u0430\u044f \u043a\u0430\u0440\u0442\u0430"),r.a.createElement(f.e,{style:{marginTop:10},before:null!=this.state.service&&null!=this.state.service.logo?r.a.createElement(f.c,{type:"image",src:"/BonusCards"+this.state.service.logo,style:{background:this.state.service.bgColor}}):r.a.createElement(f.c,{type:"image"},r.a.createElement(_.a,null))},this.state.name),r.a.createElement(f.i,null,r.a.createElement("div",null,r.a.createElement(f.y,{text:"\u041a\u0430\u0440\u0442\u0443 \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c",isShown:this.state.tooltip,alignX:"right",cornerOffset:-10,offsetX:-5,offsetY:5,onClose:this.onTooltipClose},r.a.createElement(f.n,{style:{paddingRight:56},autoFocus:!0,status:"default",onChange:this.onChangeText,value:this.state.number,type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u043a\u0430\u0440\u0442\u044b"})),r.a.createElement(je,{onClick:this.onScanClick,className:"Scan",width:30,height:30,fill:"var(--control_foreground)"}))),r.a.createElement(f.f,null,r.a.createElement(f.d,{disabled:!0===this.state.error,size:"xl",onClick:function(t){return e.onAddClick(t)}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")))}}]),t}(r.a.Component),_e=p()("cards","prefs",Se),Ie=n(94),Ae=Object(f.A)(),Be=function(e){function t(e){var n;return Object(b.a)(this,t),(n=Object(k.a)(this,Object(w.a)(t).call(this,e))).state={search:"",services:[],popular:[]},n.onChange=n.onChange.bind(Object(C.a)(n)),n.cache=new Ie.c({fixedWidth:!0,defaultHeight:100}),n}return Object(j.a)(t,e),Object(y.a)(t,[{key:"onChange",value:function(e){this.setState({search:e.substring(0,40)})}},{key:"matchSearch",value:function(e,t){return e.toLowerCase().indexOf(t)>-1}},{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({services:t.data.all,popular:t.data.all.filter((function(e){var n=e.id;return t.data.popular.includes(n)}))})}))}},{key:"renderHeader",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(f.k,{level:"secondary"},"\u041f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u043e\u0435"),this.state.popular.map((function(t){return e.renderCard(t)})),r.a.createElement(f.k,{level:"secondary"},"\u0412\u0441\u0435"))}},{key:"renderRow",value:function(e,t,n,a){var c=this.services[e];return r.a.createElement(Ie.b,{key:t,cache:this.cache,parent:a,columnIndex:0,rowIndex:e},r.a.createElement("div",{key:t,style:n},this.renderCard(c)))}},{key:"renderCard",value:function(e){var t=this;return r.a.createElement(f.e,{before:"undefined"!==typeof e.logo&&null!=e.logo?r.a.createElement(f.c,{type:"image",src:"/BonusCards"+e.logo,style:{background:e.bgColor}}):r.a.createElement(f.c,{type:"image"},r.a.createElement(_.a,null)),expandable:!0,removable:!1,key:e.id,onClick:function(){t.props.router.navigate("add",{name:e.name,serviceid:e.id})}},e.name)}},{key:"goBack",value:function(){window.history.back()}},{key:"render",value:function(){var e=this,t=this.props.id;return r.a.createElement(f.r,{id:t},r.a.createElement(f.s,{left:r.a.createElement(f.l,{onClick:this.goBack},Ae===f.m?r.a.createElement(M.a,null):r.a.createElement(T.a,null))},r.a.createElement(f.v,{theme:"header",style:{paddingRight:Ae===f.m?0:56},value:this.state.search,onChange:this.onChange,onClose:this.goBack})),0===this.state.services.length&&r.a.createElement(f.x,{size:"medium",style:{marginTop:20}}),r.a.createElement(Ie.a,null,(function(t){var n=t.height,a=t.width;return r.a.createElement(Ie.d,{width:a,height:n,deferredMeasurementCache:e.cache,rowHeight:e.cache.rowHeight,rowRenderer:function(t){var n=t.index,a=t.key,r=t.style,c=t.parent;return e.renderRow(n,a,r,c)},rowCount:e.services.length,overscanRowCount:3})})))}},{key:"services",get:function(){var e=this,t=this.state.search.toLowerCase().trim(),n=A()().transform(t),a=this.state.services.filter((function(a){return e.matchSearch(a.name,t)||e.matchSearch(a.name,n)||null!=a.keywords&&a.keywords.filter((function(a){return e.matchSearch(a,t)||e.matchSearch(a,n)})).length>0})).map((function(e){return e}));return t.length>0&&a.unshift({id:null,logo:null,name:t}),a.map((function(e){return e.name=e.name.charAt(0).toUpperCase()+e.name.slice(1),e}))}}]),t}(r.a.Component),ze=n(79),Re=n.n(ze);n(463),n(455),n(457);Re.a.initializeApp({apiKey:"AIzaSyCfEuUvuiEzVpUHg46vyWGPSISl4iyb2Mg",authDomain:"bonuscards-42f7a.firebaseapp.com",databaseURL:"https://bonuscards-42f7a.firebaseio.com",projectId:"bonuscards-42f7a",storageBucket:"bonuscards-42f7a.appspot.com",messagingSenderId:"774318858298",appId:"1:774318858298:web:0dc82b27bebdd8f1849503",measurementId:"G-HS7VBZ98KJ"}),console.log(Re.a.apps),Re.a.auth().onIdTokenChanged((function(e){return console.log("onIdTokenChanged")})),Re.a.analytics();var Me=Re.a,Ve=n(219),Te=function(e){var t=Object(a.useState)(null),n=Object(m.a)(t,2),c=n[0],o=n[1],l=Object(a.useState)(null),s=Object(m.a)(l,2),h=s[0],p=s[1],g=Object(a.useState)(null),E=Object(m.a)(g,2),b=E[0],y=E[1],k=Object(a.useState)(null),w=Object(m.a)(k,2),C=w[0],j=w[1],O=Object(a.useRef)(c);return Object(a.useEffect)((function(){O.current=c,e.router.canActivate("home",(function(e){return function(e,t){return"card"!==t.name||null===O.current||(o(null),window.history.go(1),!1)}}))}),[c]),Object(a.useEffect)((function(){console.log("app useEffect");var t=function(){var t=Object(d.a)(u.a.mark((function t(){var n,a,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("check.."),t.next=3,fetch("https://europe-west2-bonuscards-42f7a.cloudfunctions.net/token"+e.search);case 3:return n=t.sent,console.log("checked"),t.next=7,n.json();case 7:return a=t.sent,t.next=10,Me.auth().setPersistence(Me.auth.Auth.Persistence.LOCAL);case 10:return console.log("signin..."),t.next=13,Me.auth().signInWithCustomToken(a.token);case 13:r=t.sent,console.log("signed in "+r.user);case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),n=function(t){console.log("auth ok:"+t.uid),y(t),e.dispatch("cards/listen",{uid:t.uid});var n=e.hash.slice(1).split("&").map((function(e){var t=e.split("=");return{key:t[0],value:t[1]}})).reduce((function(e,t){return e[t.key]=t.value,e}),{});null!=n.add_number&&null!=n.add_name&&(console.log("share:"+n.add_name+" "+n.add_number+" "+n.add_service_id),console.log("user#1:"+t),e.router.navigate("add",{name:n.add_name,number:n.add_number,serviceid:n.add_service_id}))};console.log("user:"+Me.auth().currentUser),null!=Me.auth().currentUser?n(Me.auth().currentUser):Me.auth().onAuthStateChanged((function(e){console.log("onAuthStateChanged"),e?n(e):t().catch((function(e){j(e),console.log("auth error:"+e)}))}),(function(e){console.log(e)})),i.a.subscribe((function(t){if(console.log("event>"+t.detail.type),"VKWebAppViewRestore"===t.detail.type){var n=Me.auth().currentUser;if(n){var a=n.uid;e.dispatch("cards/api/get",a)}}}))}),[]),r.a.createElement(f.u,{activeView:null!=C?"error":!0===e.cards.loading?"splash":"main"},r.a.createElement(f.z,{id:"splash",activePanel:"splash"},r.a.createElement(f.r,{id:"splash"},r.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"75vh"}},r.a.createElement(f.x,{size:"large"})),r.a.createElement(f.g,{vertical:"bottom"},r.a.createElement(f.h,{className:"unselectable"},Ve.version)))),r.a.createElement(f.z,{id:"error",activePanel:"error"},r.a.createElement(f.r,{id:"error"},r.a.createElement(f.s,null,"\u0411\u043e\u043d\u0443\u0441 \u043a\u0430\u0440\u0442\u044b"),r.a.createElement(f.t,{icon:r.a.createElement(v.a,null)},"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437"))),r.a.createElement(f.z,{id:"main",activePanel:e.route.name,popout:c,modal:h},r.a.createElement(z,{id:"home",router:e.router,route:e.route,user:b}),r.a.createElement(q,{id:"card",router:e.router,route:e.route,setPopout:o}),r.a.createElement(Be,{id:"services",router:e.router,route:e.route}),r.a.createElement(_e,{id:"add",router:e.router,route:e.route,user:b,setModal:p})))},Pe=p()("cards",(function(e){return r.a.createElement(E.a,{nodeName:""},(function(t){var n=t.route;return r.a.createElement(Te,Object.assign({route:n},e))}))})),We=n(220),Ne=n.n(We),Ue=n(92),He=n(222),Le=[{name:"home",path:"/"},{name:"card",path:"/card/:id"},{name:"add",path:"/add?serviceid&name&number"},{name:"services",path:"/services?q"}];var Ke=n(223),De=n.n(Ke),Je=n(142),qe=n.n(Je);function Fe(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Ge=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.subscribe((function(e){switch(e.detail.type){case"VKWebAppUpdateConfig":var t=document.createAttribute("scheme");t.value=e.detail.data.scheme?e.detail.data.scheme:"client_light",document.body.attributes.setNamedItem(t);break;default:console.log(e.detail.type)}})),i.a.send("VKWebAppInit");var Qe=Ne()([function(e){e.on("@init",(function(){return{cards:{loading:!0,data:[]}}})),e.on("cards/save",(function(e,t){var n=e.cards,a=t.cardsToSave;return n.data=a,n.loading=!1,console.log("update cards"),{cards:n}})),e.on("cards/listen",(function(t,n){t.cards;var a=n.uid;Me.firestore().collection("cards").where("uid","==",a).onSnapshot({includeMetadataChanges:!0},(function(t){console.log("onSnapshot "),e.dispatch("cards/api/get",a)}))})),e.on("cards/api/get",(function(t,n){t.cards;Me.firestore().collection("cards").where("uid","==",n).get().then((function(t){var n=t.docs.map((function(e){return{docId:e.id,uid:e.data().uid,id:e.data().id,name:e.data().name,number:e.data().number,serviceId:e.data().service_id}}));e.dispatch("cards/save",{cardsToSave:n})}))})),e.on("cards/api/add",(function(e,t){e.cards;var n=Me.firestore();t.id=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=n.length,r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*a));return t}(20),n.collection("cards").add({uid:t.uid,id:t.id,name:t.name,number:t.number,service_id:t.serviceId})})),e.on("cards/api/delete",(function(e,t){e.cards;Me.firestore().collection("cards").doc(t.docId).delete()}))},function(e){e.on("@init",(function(){return{prefs:{}}})),e.on("prefs/set",(function(e,t){var n=e.prefs;return n[t.key]=t.value,n}))},De()(["prefs"])]),Xe=function(){var e=Object(Ue.b)(Le,{defaultRoute:"home"});return e.usePlugin(Object(He.a)({useHash:!0})),e}();!function(){if("serviceWorker"in navigator){if(new URL("/BonusCards",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/BonusCards","/service-worker.js");Ge?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Fe(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Fe(e)}))}}();var Ye=window.location.search,Ze=window.location.hash;Xe.start((function(){o.a.render(r.a.createElement(E.b,{router:Xe},r.a.createElement(qe.a.Provider,{value:Qe},r.a.createElement(Pe,{router:Xe,search:Ye,hash:Ze}))),document.getElementById("root"))}))},99:function(e,t,n){}},[[270,1,2]]]);
//# sourceMappingURL=main.20ea60de.chunk.js.map