(this.webpackJsonpbonus_cards=this.webpackJsonpbonus_cards||[]).push([[0],{213:function(e,t,a){e.exports=a.p+"static/media/barcode_how.f8d6a335.png"},219:function(e){e.exports=JSON.parse('{"name":"bonus_cards","version":"1.3.20","description":"","main":"index.js","homepage":"https://nikitazhelonkin.github.io/BonusCards/","scripts":{"predeploy":"npm run build","deploy":"gh-pages -d build","start":"cross-env PORT=10888 react-scripts start","build":"react-scripts build"},"keywords":[],"author":"","license":"MIT","devDependencies":{"cross-env":"^5.2.1","react-hot-loader":"^4.12.18","react-scripts":"^3.2.0"},"dependencies":{"@storeon/localstorage":"^0.6.3","@vkontakte/icons":"^1.11.4","@vkontakte/vk-connect":"^1.6.11","@vkontakte/vk-mini-apps-api":"^0.2.0","@vkontakte/vkui":"^2.33.3","babel-eslint":"^10.0.3","chalk":"^2.4.2","core-js":"^3.4.4","cyrillic-to-translit-js":"^3.0.1","firebase":"^7.7.0","gh-pages":"^2.1.1","msgpack":"^1.0.3","msgpack-lite":"^0.1.26","prop-types":"^15.7.2","react":"^16.12.0","react-barcode":"^1.4.0","react-barcode-reader":"0.0.1","react-detect-offline":"^2.4.0","react-dom":"^16.12.0","react-router5":"^7.1.0","react-virtualized":"^9.21.2","router5":"^7.0.2","router5-history":"^3.0.4","router5-plugin-browser":"^7.0.2","router5-plugin-logger":"^7.0.2","storeon":"^0.8.7"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},270:function(e,t,a){e.exports=a(462)},462:function(e,t,a){"use strict";a.r(t);a(271),a(298),a(300),a(301),a(303),a(304),a(305),a(306),a(307),a(308),a(309),a(310),a(312),a(313),a(314),a(315),a(316),a(317),a(318),a(319),a(320),a(321),a(323),a(324),a(325),a(326),a(327),a(328),a(329),a(330),a(331),a(332),a(333),a(334),a(335),a(336),a(337),a(338),a(339),a(340);var n=a(0),r=a.n(n),c=a(30),l=a.n(c),o=a(34),i=a.n(o),s=a(144),u=a.n(s),d=a(196),m=a(65),h=a(70),p=a.n(h),f=a(4),g=a(64),v=a.n(g),E=a(108),b=(a(360),a(71)),y=a(72),k=a(77),C=a(74),w=a(73),j=a(78),O=a(209),x=a.n(O),S=a(75),I=a.n(S),_=a(109),A=a.n(_),V=(a(99),function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(k.a)(this,Object(C.a)(t).call(this,e))).state={search:"",services:[]},a.onChange=a.onChange.bind(Object(w.a)(a)),a}return Object(j.a)(t,e),Object(y.a)(t,[{key:"onChange",value:function(e){this.setState({search:e})}},{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({services:t.data.all})}))}},{key:"render",value:function(){var e=this.props,t=e.id,a=e.router;return r.a.createElement(f.r,{id:t},r.a.createElement(f.s,{noShadow:!0},"\u0411\u043e\u043d\u0443\u0441 \u043a\u0430\u0440\u0442\u044b"),r.a.createElement(f.g,{vertical:"top"},r.a.createElement(f.v,{value:this.state.search,onChange:this.onChange,theme:"default"})),0===this.cards.length&&0===this.state.search.length?r.a.createElement("div",null,r.a.createElement("div",{style:{height:52}}),r.a.createElement(f.t,{icon:r.a.createElement(v.a,null)},"\u0412\u044b \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u043d\u0438 \u043e\u0434\u043d\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438")):0===this.cards.length&&r.a.createElement("div",null,r.a.createElement("div",{style:{height:52}}),r.a.createElement(f.t,{icon:r.a.createElement(v.a,null)},"\u041f\u043e \u0412\u0430\u0448\u0435\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")),r.a.createElement(f.o,{style:{paddingTop:60,marginBottom:60}},this.cards.map((function(e){return r.a.createElement(f.e,{before:"undefined"!==typeof e.logo&&null!=e.logo?r.a.createElement(f.c,{type:"image",src:"/BonusCards"+e.logo,style:{background:e.bgColor}}):r.a.createElement(f.c,{type:"image"},r.a.createElement(I.a,null)),multiline:!0,expandable:!0,removable:!1,key:e.id,onClick:function(){return a.navigate("card",{id:e.id})},description:e.number},e.name)}))),r.a.createElement(f.g,{vertical:"bottom"},Object(f.A)()===f.a?r.a.createElement(f.f,{style:{float:"right"}},r.a.createElement(f.d,{className:"FixedBottomButton",onClick:function(){return a.navigate("services")}},r.a.createElement(x.a,null))):r.a.createElement(f.f,null,r.a.createElement(f.d,{size:"xl",onClick:function(){return a.navigate("services")}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u043a\u0430\u0440\u0442\u0443"))))}},{key:"cards",get:function(){var e=this,t=this.props.cards.data,a=this.state.search.toLowerCase().trim(),n=A()().transform(a);return t.filter((function(e){var t=e.name;return t.toLowerCase().indexOf(a)>-1||t.toLowerCase().indexOf(n)>-1})).map((function(t){var a=e.state.services.filter((function(e){return e.id===t.serviceId}))[0];return{id:t.id,name:t.name,number:t.number,logo:null!=a?a.logo:null,bgColor:null!=a?a.bgColor:null}}))}}]),t}(r.a.Component)),z=p()("cards",V),B=a(76),M=a.n(B),R=a(54),P=a.n(R),T=a(210),H=a.n(T),N=a(211),U=a.n(N),W=a(212),K=a.n(W),L=a(141),D=a.n(L),J=Object(f.A)(),q=function(e){var t=D()("cards"),a=t.dispatch,c=t.cards,l=Object(n.useState)(null),o=Object(m.a)(l,2),s=o[0],u=o[1],d=c.data.filter((function(t){return t.id===e.route.params.id}))[0],h=function(){e.setPopout(null)};return r.a.createElement(f.r,{id:e.id},r.a.createElement(f.s,{left:r.a.createElement(f.l,{onClick:function(){return window.history.back()}},J===f.m?r.a.createElement(M.a,null):r.a.createElement(P.a,null))},"undefined"!==typeof d?d.name:"\u0423\u043f\u0441"),"undefined"!==typeof d&&r.a.createElement("div",null,r.a.createElement(f.j,null,r.a.createElement("div",{className:"BarcodeContainer",onClick:function(){u(!0),i.a.send("VKWebAppCopyText",{text:d.number})}},r.a.createElement("div",{className:"Barcode"},r.a.createElement(K.a,{value:d.number.toString(),displayValue:!0,fontSize:25,height:120})))),r.a.createElement(f.h,{className:"unselectable"},"\u041f\u0440\u0435\u0434\u044a\u044f\u0432\u0438\u0442\u0435 \u044d\u0442\u043e\u0442 \u043a\u043e\u0434 \u043d\u0430 \u043a\u0430\u0441\u0441\u0435 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0430"),r.a.createElement(f.f,{style:{display:"flex"}},r.a.createElement(f.d,{before:r.a.createElement(U.a,null),size:"l",stretched:!0,level:"secondary",onClick:function(){var e="https://vk.com/app7225850#add_name="+encodeURIComponent(d.name)+"&add_service_id="+d.serviceId+"&add_number="+d.number;console.log(e),i.a.send("VKWebAppShare",{link:e})},style:{marginRight:8}},"\u041f\u043e\u0434\u0435\u043b\u0438\u0442\u044c\u0441\u044f"),r.a.createElement(f.d,{before:r.a.createElement(H.a,null),size:"l",stretched:!0,level:"destructive",onClick:function(){e.setPopout(r.a.createElement(f.b,{actionsLayout:"vertical",onClose:h,actions:[{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",false:!0,style:"destructive",action:function(){h(),window.history.back(),a("cards/api/delete",d)}},{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,style:"cancel"}]},r.a.createElement("h2",null,"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"),r.a.createElement("p",null,"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435",r.a.createElement("br",null),"\u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0443 ",d.name,"?")))}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))),"undefined"===typeof d&&r.a.createElement(f.t,{icon:r.a.createElement(v.a,null)},"\u0422\u0430\u043a\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0435\u0442, \u043b\u0438\u0431\u043e \u043e\u043d\u0430 \u0431\u044b\u043b\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0430"),s&&r.a.createElement(f.w,{layout:"vertical",onClose:function(){return u(!1)}},"\u041d\u043e\u043c\u0435\u0440 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430"))};function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function G(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var X=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M80,48H16C7.168,48,0,55.168,0,64v64c0,8.832,7.168,16,16,16c8.832,0,16-7.168,16-16V80h48c8.832,0,16-7.168,16-16 C96,55.168,88.832,48,80,48z"}))),Q=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M464,336c-8.832,0-16,7.168-16,16v48h-48c-8.832,0-16,7.168-16,16c0,8.832,7.168,16,16,16h64c8.832,0,16-7.168,16-16v-64 C480,343.168,472.832,336,464,336z"}))),Y=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M464,48h-64c-8.832,0-16,7.168-16,16c0,8.832,7.168,16,16,16h48v48c0,8.832,7.168,16,16,16c8.832,0,16-7.168,16-16V64 C480,55.168,472.832,48,464,48z"}))),Z=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M80,400H32v-48c0-8.832-7.168-16-16-16c-8.832,0-16,7.168-16,16v64c0,8.832,7.168,16,16,16h64c8.832,0,16-7.168,16-16 C96,407.168,88.832,400,80,400z"}))),$=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:64,y:112,width:32,height:256}))),ee=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:128,y:112,width:32,height:192}))),te=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:192,y:112,width:32,height:192}))),ae=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:256,y:112,width:32,height:256}))),ne=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:320,y:112,width:32,height:192}))),re=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:384,y:112,width:32,height:256}))),ce=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:128,y:336,width:32,height:32}))),le=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:192,y:336,width:32,height:32}))),oe=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:320,y:336,width:32,height:32}))),ie=r.a.createElement("g",null),se=r.a.createElement("g",null),ue=r.a.createElement("g",null),de=r.a.createElement("g",null),me=r.a.createElement("g",null),he=r.a.createElement("g",null),pe=r.a.createElement("g",null),fe=r.a.createElement("g",null),ge=r.a.createElement("g",null),ve=r.a.createElement("g",null),Ee=r.a.createElement("g",null),be=r.a.createElement("g",null),ye=r.a.createElement("g",null),ke=r.a.createElement("g",null),Ce=r.a.createElement("g",null),we=function(e){var t=e.svgRef,a=e.title,n=G(e,["svgRef","title"]);return r.a.createElement("svg",F({id:"Capa_1",x:"0px",y:"0px",viewBox:"0 0 480 480",style:{enableBackground:"new 0 0 480 480"},xmlSpace:"preserve",ref:t},n),a?r.a.createElement("title",null,a):null,X,Q,Y,Z,$,ee,te,ae,ne,re,ce,le,oe,ie,se,ue,de,me,he,pe,fe,ge,ve,Ee,be,ye,ke,Ce)},je=r.a.forwardRef((function(e,t){return r.a.createElement(we,F({svgRef:t},e))})),Oe=(a.p,a(213)),xe=a.n(Oe),Se=function(e){function t(e){var a;Object(b.a)(this,t),(a=Object(k.a)(this,Object(C.a)(t).call(this,e))).onTooltipClose=function(){a.props.dispatch("prefs/set",{key:"scan_tooltip_shown",value:!0}),a.setState({tooltip:!1})},a.onDone=function(e){a.setState({number:e.qr_data,error:!1})},a.onError=function(e){},a.onScanClick=function(e){!0!==a.props.prefs.scan_ios_tooltip_shown&&f.A===f.m?a.props.setModal(r.a.createElement(f.q,{activeModal:"modal"},r.a.createElement(f.p,{id:"modal",onClose:function(){return a.props.setModal(null)},icon:r.a.createElement(f.c,{type:"app",src:xe.a,size:72}),title:"\u0427\u0442\u043e\u0431\u044b \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u043d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u043d\u0430 \u043d\u0438\u0436\u043d\u044e\u044e \u0447\u0430\u0441\u0442\u044c \u0440\u0430\u043c\u043a\u0438",caption:"\u041d\u0430\u0439\u0434\u0438\u0442\u0435 \u0445\u043e\u0440\u043e\u0448\u0435\u0435 \u043e\u0441\u0432\u0435\u0449\u0435\u043d\u0438\u0435",actions:[{title:"\u0411\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c",type:"secondary",action:function(){a.props.dispatch("prefs/set",{key:"scan_ios_tooltip_shown",value:!0}),a.props.setModal(null),a.scan(e)}},{title:"\u041f\u043e\u043d\u044f\u043b",type:"primary",action:function(){a.props.setModal(null),a.scan(e)}}]}))):a.scan(e)},a.scan=function(e){i.a.sendPromise("VKWebAppOpenQR").then(a.onDone).catch(a.onError)},a.goBack=function(){window.history.back()},a.goHome=function(){a.props.router.navigate("home",{},{replace:!0})},a.onAddClick=function(){var e=a.state,t=e.name,n=e.number;if(a.isValidName(t)&&a.isValidCard(n)){a.setState({error:!1});var r=a.state.serviceId,c=a.props.user.uid;a.props.dispatch("cards/api/add",{uid:c,name:t,number:n,serviceId:r}),a.goHome()}else a.setState({error:!0})},a.onChangeText=function(e){var t=e.target.value.trim().substring(0,24).replace(/[^\x00-\x7F]/g,"");a.setState({number:t,error:!a.isValidCard(t)})};var n=e.route.params.number||"";return a.state={tooltip:!0!==e.prefs.scan_tooltip_shown,serviceId:e.route.params.serviceid,name:decodeURIComponent(e.route.params.name),number:n,error:!a.isValidCard(n),service:null},a}return Object(j.a)(t,e),Object(y.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({service:t.data.all.filter((function(t){return t.id===e.state.serviceId}))[0]})}))}},{key:"isValidName",value:function(e){return""!==e}},{key:"isValidCard",value:function(e){return null!=e&&e.match("^[\0-\x7f]{6,24}$")}},{key:"render",value:function(){var e=this,t=Object(f.A)();return r.a.createElement(f.r,{id:this.props.id},r.a.createElement(f.s,{left:r.a.createElement(f.l,{onClick:function(){return e.goBack()}},t===f.m?r.a.createElement(M.a,null):r.a.createElement(P.a,null))},"\u041d\u043e\u0432\u0430\u044f \u043a\u0430\u0440\u0442\u0430"),r.a.createElement(f.e,{style:{marginTop:10},before:null!=this.state.service&&null!=this.state.service.logo?r.a.createElement(f.c,{type:"image",src:"/BonusCards"+this.state.service.logo,style:{background:this.state.service.bgColor}}):r.a.createElement(f.c,{type:"image"},r.a.createElement(I.a,null))},this.state.name),r.a.createElement(f.i,null,r.a.createElement("div",null,r.a.createElement(f.y,{text:"\u041a\u0430\u0440\u0442\u0443 \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c",isShown:this.state.tooltip,alignX:"right",cornerOffset:-10,offsetX:-5,offsetY:5,onClose:this.onTooltipClose},r.a.createElement(f.n,{style:{paddingRight:56},autoFocus:!0,status:"default",onChange:this.onChangeText,value:this.state.number,type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u043a\u0430\u0440\u0442\u044b"})),r.a.createElement(je,{onClick:this.onScanClick,className:"Scan",width:30,height:30,fill:"var(--control_foreground)"}))),r.a.createElement(f.f,null,r.a.createElement(f.d,{disabled:!0===this.state.error,size:"xl",onClick:function(t){return e.onAddClick(t)}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")))}}]),t}(r.a.Component),Ie=p()("cards","prefs",Se),_e=a(94),Ae=Object(f.A)(),Ve=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(k.a)(this,Object(C.a)(t).call(this,e))).state={search:"",services:[],popular:[]},a.onChange=a.onChange.bind(Object(w.a)(a)),a.cache=new _e.c({fixedWidth:!0,defaultHeight:100}),a}return Object(j.a)(t,e),Object(y.a)(t,[{key:"onChange",value:function(e){this.setState({search:e.substring(0,40)})}},{key:"matchSearch",value:function(e,t){return e.toLowerCase().indexOf(t)>-1}},{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({services:t.data.all,popular:t.data.all.filter((function(e){var a=e.id;return t.data.popular.includes(a)}))})}))}},{key:"renderHeader",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(f.k,{level:"secondary"},"\u041f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u043e\u0435"),this.state.popular.map((function(t){return e.renderCard(t)})),r.a.createElement(f.k,{level:"secondary"},"\u0412\u0441\u0435"))}},{key:"renderRow",value:function(e,t,a,n){var c=this.services[e];return r.a.createElement(_e.b,{key:t,cache:this.cache,parent:n,columnIndex:0,rowIndex:e},r.a.createElement("div",{key:t,style:a},this.renderCard(c)))}},{key:"renderCard",value:function(e){var t=this;return r.a.createElement(f.e,{before:"undefined"!==typeof e.logo&&null!=e.logo?r.a.createElement(f.c,{type:"image",src:"/BonusCards"+e.logo,style:{background:e.bgColor}}):r.a.createElement(f.c,{type:"image"},r.a.createElement(I.a,null)),expandable:!0,removable:!1,key:e.id,onClick:function(){t.props.router.navigate("add",{name:e.name,serviceid:e.id})}},e.name)}},{key:"goBack",value:function(){window.history.back()}},{key:"render",value:function(){var e=this,t=this.props.id;return r.a.createElement(f.r,{id:t},r.a.createElement(f.s,{left:r.a.createElement(f.l,{onClick:this.goBack},Ae===f.m?r.a.createElement(M.a,null):r.a.createElement(P.a,null))},r.a.createElement(f.v,{theme:"header",style:{paddingRight:Ae===f.m?0:56},value:this.state.search,onChange:this.onChange,onClose:this.goBack})),0===this.state.services.length&&r.a.createElement(f.x,{size:"medium",style:{marginTop:20}}),r.a.createElement(_e.a,null,(function(t){var a=t.height,n=t.width;return r.a.createElement(_e.d,{width:n,height:a,deferredMeasurementCache:e.cache,rowHeight:e.cache.rowHeight,rowRenderer:function(t){var a=t.index,n=t.key,r=t.style,c=t.parent;return e.renderRow(a,n,r,c)},rowCount:e.services.length,overscanRowCount:3})})))}},{key:"services",get:function(){var e=this,t=this.state.search.toLowerCase().trim(),a=A()().transform(t),n=this.state.services.filter((function(n){return e.matchSearch(n.name,t)||e.matchSearch(n.name,a)||null!=n.keywords&&n.keywords.filter((function(n){return e.matchSearch(n,t)||e.matchSearch(n,a)})).length>0})).map((function(e){return e}));return t.length>0&&n.unshift({id:null,logo:null,name:t}),n.map((function(e){return e.name=e.name.charAt(0).toUpperCase()+e.name.slice(1),e}))}}]),t}(r.a.Component),ze=a(93),Be=a.n(ze);a(463),a(455),a(457);Be.a.initializeApp({apiKey:"AIzaSyCfEuUvuiEzVpUHg46vyWGPSISl4iyb2Mg",authDomain:"bonuscards-42f7a.firebaseapp.com",databaseURL:"https://bonuscards-42f7a.firebaseio.com",projectId:"bonuscards-42f7a",storageBucket:"bonuscards-42f7a.appspot.com",messagingSenderId:"774318858298",appId:"1:774318858298:web:0dc82b27bebdd8f1849503",measurementId:"G-HS7VBZ98KJ"}),Be.a.auth().onIdTokenChanged((function(e){return console.log("onIdTokenChanged")})),Be.a.analytics();var Me=Be.a,Re=a(219),Pe=function(e){var t=Object(n.useState)(null),a=Object(m.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)(null),s=Object(m.a)(o,2),h=s[0],p=s[1],g=Object(n.useState)(null),E=Object(m.a)(g,2),b=E[0],y=E[1],k=Object(n.useState)(null),C=Object(m.a)(k,2),w=C[0],j=C[1],O=Object(n.useRef)(c);return Object(n.useEffect)((function(){O.current=c,e.router.canActivate("home",(function(e){return function(e,t){return"card"!==t.name||null===O.current||(l(null),window.history.go(1),!1)}}))}),[c]),Object(n.useEffect)((function(){var t,a=function(){var t=Object(d.a)(u.a.mark((function t(){var a,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://europe-west2-bonuscards-42f7a.cloudfunctions.net/token"+e.search);case 2:return a=t.sent,t.next=5,a.json();case 5:return n=t.sent,console.log("params checked"),t.next=9,Me.auth().setPersistence(Me.auth.Auth.Persistence.LOCAL);case 9:return console.log("signInWithCustomToken"),t.next=12,Me.auth().signInWithCustomToken(n.token);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),n=function(t){y(t),e.dispatch("cards/listen",{uid:t.uid});var a=e.hash.slice(1).split("&").map((function(e){var t=e.split("=");return{key:t[0],value:t[1]}})).reduce((function(e,t){return e[t.key]=t.value,e}),{});null!=a.add_number&&null!=a.add_name&&e.router.navigate("add",{name:a.add_name,number:a.add_number,serviceid:a.add_service_id})};null!=Me.auth().currentUser?n(Me.auth().currentUser):t=Me.auth().onAuthStateChanged((function(e){e?n(e):a().catch((function(e){j(e),console.log("auth error:"+e)}))}),(function(e){console.log(e)})),i.a.subscribe((function(e){console.log("event>"+e.detail.type),"VKWebAppViewRestore"===e.detail.type?null!=Me.auth().currentUser?n(Me.auth().currentUser):t=Me.auth().onAuthStateChanged((function(e){e?n(e):a().catch((function(e){j(e),console.log("auth error:"+e)}))}),(function(e){console.log(e)})):"VKWebAppViewHide"===e.detail.type&&(console.log("terminate"),Me.firestore().terminate(),t.call())}))}),[]),r.a.createElement(f.u,{activeView:null!=w?"error":!0===e.cards.loading?"splash":"main"},r.a.createElement(f.z,{id:"splash",activePanel:"splash"},r.a.createElement(f.r,{id:"splash"},r.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"75vh"}},r.a.createElement(f.x,{size:"large"})),r.a.createElement(f.g,{vertical:"bottom"},r.a.createElement(f.h,{className:"unselectable"},Re.version)))),r.a.createElement(f.z,{id:"error",activePanel:"error"},r.a.createElement(f.r,{id:"error"},r.a.createElement(f.s,null,"\u0411\u043e\u043d\u0443\u0441 \u043a\u0430\u0440\u0442\u044b"),r.a.createElement(f.t,{icon:r.a.createElement(v.a,null)},"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437"))),r.a.createElement(f.z,{id:"main",activePanel:e.route.name,popout:c,modal:h},r.a.createElement(z,{id:"home",router:e.router,route:e.route,user:b}),r.a.createElement(q,{id:"card",router:e.router,route:e.route,setPopout:l}),r.a.createElement(Ve,{id:"services",router:e.router,route:e.route}),r.a.createElement(Ie,{id:"add",router:e.router,route:e.route,user:b,setModal:p})))},Te=p()("cards",(function(e){return r.a.createElement(E.a,{nodeName:""},(function(t){var a=t.route;return r.a.createElement(Pe,Object.assign({route:a},e))}))})),He=a(220),Ne=a.n(He),Ue=a(91),We=a(222),Ke=[{name:"home",path:"/"},{name:"card",path:"/card/:id"},{name:"add",path:"/add?serviceid&name&number"},{name:"services",path:"/services?q"}];var Le=a(223),De=a.n(Le),Je=a(142),qe=a.n(Je);i.a.subscribe((function(e){switch(console.log(e.detail.type),e.detail.type){case"VKWebAppUpdateConfig":var t=document.createAttribute("scheme");t.value=e.detail.data.scheme?e.detail.data.scheme:"client_light",document.body.attributes.setNamedItem(t)}})),i.a.send("VKWebAppInit");var Fe=Ne()([function(e){e.on("@init",(function(){return{cards:{loading:!0,data:[]}}})),e.on("cards/save",(function(e,t){var a=e.cards,n=t.cardsToSave;return a.data=n,a.loading=!1,console.log("update cards"),{cards:a}})),e.on("cards/listen",(function(t,a){t.cards;var n=a.uid;Me.firestore().collection("cards").where("uid","==",n).onSnapshot({includeMetadataChanges:!0},(function(t){console.log(t),e.dispatch("cards/api/get",n)}))})),e.on("cards/api/get",(function(t,a){t.cards;Me.firestore().collection("cards").where("uid","==",a).get().then((function(t){var a=t.docs.map((function(e){return{docId:e.id,uid:e.data().uid,id:e.data().id,name:e.data().name,number:e.data().number,serviceId:e.data().service_id}}));e.dispatch("cards/save",{cardsToSave:a})})).catch((function(e){console.log("error get cards from firebase:"+e)}))})),e.on("cards/api/add",(function(e,t){e.cards;var a=Me.firestore();t.id=function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*n));return t}(20),a.collection("cards").add({uid:t.uid,id:t.id,name:t.name,number:t.number,service_id:t.serviceId})})),e.on("cards/api/delete",(function(e,t){e.cards;Me.firestore().collection("cards").doc(t.docId).delete()}))},function(e){e.on("@init",(function(){return{prefs:{}}})),e.on("prefs/set",(function(e,t){var a=e.prefs;return a[t.key]=t.value,a}))},De()(["prefs"])]),Ge=function(){var e=Object(Ue.b)(Ke,{defaultRoute:"home"});return e.usePlugin(Object(We.a)({useHash:!0})),e}(),Xe=window.location.search,Qe=window.location.hash;Ge.start((function(){l.a.render(r.a.createElement(E.b,{router:Ge},r.a.createElement(qe.a.Provider,{value:Fe},r.a.createElement(Te,{router:Ge,search:Xe,hash:Qe}))),document.getElementById("root"))}))},99:function(e,t,a){}},[[270,1,2]]]);
//# sourceMappingURL=main.749f8e45.chunk.js.map