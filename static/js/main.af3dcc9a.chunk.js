(this.webpackJsonpbonus_cards=this.webpackJsonpbonus_cards||[]).push([[0],{208:function(e,t,a){e.exports=a.p+"static/media/barcode_how.f8d6a335.png"},214:function(e){e.exports=JSON.parse('{"name":"bonus_cards","version":"1.4.22","description":"","main":"index.js","homepage":"https://nikitazhelonkin.github.io/BonusCards/","scripts":{"predeploy":"npm run build","deploy":"gh-pages -d build","start":"cross-env PORT=10888 react-scripts start","build":"react-scripts build"},"keywords":[],"author":"","license":"MIT","devDependencies":{"cross-env":"^5.2.1","react-hot-loader":"^4.12.18","react-scripts":"^3.2.0"},"dependencies":{"@storeon/localstorage":"^0.6.3","@vkontakte/icons":"^1.11.4","@vkontakte/vk-connect":"^1.6.11","@vkontakte/vk-mini-apps-api":"^0.2.0","@vkontakte/vkui":"^2.33.3","babel-eslint":"^10.0.3","chalk":"^2.4.2","core-js":"^3.4.4","cyrillic-to-translit-js":"^3.0.1","firebase":"^7.7.0","gh-pages":"^2.1.1","msgpack":"^1.0.3","msgpack-lite":"^0.1.26","prop-types":"^15.7.2","react":"^16.12.0","react-barcode":"^1.4.0","react-barcode-reader":"0.0.1","react-detect-offline":"^2.4.0","react-dom":"^16.12.0","react-router5":"^7.1.0","react-virtualized":"^9.21.2","router5":"^7.0.2","router5-history":"^3.0.4","router5-plugin-browser":"^7.0.2","router5-plugin-logger":"^7.0.2","storeon":"^0.8.7"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},262:function(e,t,a){e.exports=a(453)},453:function(e,t,a){"use strict";a.r(t);a(263),a(290),a(292),a(293),a(295),a(296),a(297),a(298),a(299),a(300),a(301),a(302),a(304),a(305),a(306),a(307),a(308),a(309),a(310),a(311),a(312),a(313),a(315),a(316),a(317),a(318),a(319),a(320),a(321),a(322),a(323),a(324),a(325),a(326),a(327),a(328),a(329),a(330),a(331),a(332);var n=a(0),r=a.n(n),c=a(31),l=a.n(c),o=a(30),i=a.n(o),s=a(140),u=a.n(s),d=a(191),m=a(48),h=a(68),p=a.n(h),g=a(4),f=a(63),v=a.n(f),E=(a(352),a(69)),b=a(70),y=a(75),k=a(72),C=a(71),w=a(76),j=a(204),O=a.n(j),x=a(73),S=a.n(x),I=a(105),_=a.n(I),B=(a(96),function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(y.a)(this,Object(k.a)(t).call(this,e))).state={search:"",services:[]},a.onChange=a.onChange.bind(Object(C.a)(a)),a}return Object(w.a)(t,e),Object(b.a)(t,[{key:"onChange",value:function(e){this.setState({search:e})}},{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({services:t.data.all})}))}},{key:"render",value:function(){var e=this,t=this.props.id;return r.a.createElement(g.s,{id:t},r.a.createElement(g.t,{noShadow:!0},"\u0411\u043e\u043d\u0443\u0441 \u043a\u0430\u0440\u0442\u044b"),r.a.createElement(g.h,{vertical:"top"},r.a.createElement(g.w,{value:this.state.search,onChange:this.onChange,theme:"default"})),0===this.cards.length&&0===this.state.search.length?r.a.createElement("div",null,r.a.createElement("div",{style:{height:52}}),r.a.createElement(g.u,{icon:r.a.createElement(v.a,null)},"\u0412\u044b \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u043d\u0438 \u043e\u0434\u043d\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438")):0===this.cards.length&&r.a.createElement("div",null,r.a.createElement("div",{style:{height:52}}),r.a.createElement(g.u,{icon:r.a.createElement(v.a,null)},"\u041f\u043e \u0412\u0430\u0448\u0435\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e")),r.a.createElement(g.p,{style:{paddingTop:60,marginBottom:60}},this.cards.map((function(t){return r.a.createElement(g.e,{before:"undefined"!==typeof t.logo&&null!=t.logo?r.a.createElement(g.c,{type:"image",src:"/BonusCards"+t.logo,style:{background:t.bgColor}}):r.a.createElement(g.c,{type:"image"},r.a.createElement(S.a,null)),multiline:!0,expandable:!0,removable:!1,key:t.id,onClick:function(){return e.props.goToPage("card",{id:t.id})},description:t.number},t.name)}))),r.a.createElement(g.h,{vertical:"bottom"},Object(g.B)()===g.a?r.a.createElement(g.g,{style:{float:"right"}},r.a.createElement(g.d,{className:"FixedBottomButton",onClick:function(){return e.props.goToPage("services")}},r.a.createElement(O.a,null))):r.a.createElement(g.g,null,r.a.createElement(g.d,{size:"xl",onClick:function(){return e.props.goToPage("services")}},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u043a\u0430\u0440\u0442\u0443"))))}},{key:"cards",get:function(){var e=this,t=this.props.cards.data,a=this.state.search.toLowerCase().trim(),n=_()().transform(a);return t.filter((function(e){var t=e.name;return t.toLowerCase().indexOf(a)>-1||t.toLowerCase().indexOf(n)>-1})).map((function(t){var a=e.state.services.filter((function(e){return e.id===t.serviceId}))[0];return{id:t.id,name:t.name,number:t.number,logo:null!=a?a.logo:null,bgColor:null!=a?a.bgColor:null}}))}}]),t}(r.a.Component)),P=p()("cards",B),T=a(74),V=a.n(T),A=a(54),M=a.n(A),z=a(205),R=a.n(z),W=a(206),H=a.n(W),K=a(207),L=a.n(K),N=a(137),U=a.n(N),D=Object(g.B)(),J=function(e){var t=U()("cards"),a=t.dispatch,c=t.cards,l=Object(n.useState)(null),o=Object(m.a)(l,2),s=o[0],u=o[1],d=c.data.filter((function(t){return t.id===e.args.id}))[0],h=function(){e.setPopout(null)};return r.a.createElement(g.s,{id:e.id},r.a.createElement(g.t,{left:r.a.createElement(g.m,{onClick:function(){return window.history.back()}},D===g.n?r.a.createElement(V.a,null):r.a.createElement(M.a,null))},"undefined"!==typeof d?d.name:"\u0423\u043f\u0441"),"undefined"!==typeof d&&r.a.createElement("div",null,r.a.createElement(g.k,null,r.a.createElement("div",{className:"BarcodeContainer",onClick:function(){u(!0),i.a.send("VKWebAppCopyText",{text:d.number})}},r.a.createElement("div",{className:"Barcode"},r.a.createElement(L.a,{value:d.number.toString(),displayValue:!0,fontSize:25,height:120})))),r.a.createElement(g.i,{className:"unselectable"},"\u041f\u0440\u0435\u0434\u044a\u044f\u0432\u0438\u0442\u0435 \u044d\u0442\u043e\u0442 \u043a\u043e\u0434 \u043d\u0430 \u043a\u0430\u0441\u0441\u0435 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u0430"),r.a.createElement(g.g,{style:{display:"flex"}},r.a.createElement(g.d,{before:r.a.createElement(H.a,null),size:"l",stretched:!0,level:"secondary",onClick:function(){var e="https://vk.com/app7225850#add_name="+encodeURIComponent(d.name)+"&add_service_id="+d.serviceId+"&add_number="+d.number;console.log(e),i.a.send("VKWebAppShare",{link:e})},style:{marginRight:8}},"\u041f\u043e\u0434\u0435\u043b\u0438\u0442\u044c\u0441\u044f"),r.a.createElement(g.d,{before:r.a.createElement(R.a,null),size:"l",stretched:!0,level:"destructive",onClick:function(){e.setPopout(r.a.createElement(g.b,{actionsLayout:"vertical",onClose:h,actions:[{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",false:!0,style:"destructive",action:function(){h(),window.history.back(),a("cards/api/delete",d)}},{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,style:"cancel"}]},r.a.createElement("h2",null,"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"),r.a.createElement("p",null,"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435",r.a.createElement("br",null),"\u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0443 ",d.name,"?")))}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))),"undefined"===typeof d&&r.a.createElement(g.u,{icon:r.a.createElement(v.a,null)},"\u0422\u0430\u043a\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0435\u0442, \u043b\u0438\u0431\u043e \u043e\u043d\u0430 \u0431\u044b\u043b\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0430"),s&&r.a.createElement(g.x,{layout:"vertical",onClose:function(){return u(!1)}},"\u041d\u043e\u043c\u0435\u0440 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430"))};function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function q(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var G=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M80,48H16C7.168,48,0,55.168,0,64v64c0,8.832,7.168,16,16,16c8.832,0,16-7.168,16-16V80h48c8.832,0,16-7.168,16-16 C96,55.168,88.832,48,80,48z"}))),X=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M464,336c-8.832,0-16,7.168-16,16v48h-48c-8.832,0-16,7.168-16,16c0,8.832,7.168,16,16,16h64c8.832,0,16-7.168,16-16v-64 C480,343.168,472.832,336,464,336z"}))),Q=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M464,48h-64c-8.832,0-16,7.168-16,16c0,8.832,7.168,16,16,16h48v48c0,8.832,7.168,16,16,16c8.832,0,16-7.168,16-16V64 C480,55.168,472.832,48,464,48z"}))),Y=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("path",{d:"M80,400H32v-48c0-8.832-7.168-16-16-16c-8.832,0-16,7.168-16,16v64c0,8.832,7.168,16,16,16h64c8.832,0,16-7.168,16-16 C96,407.168,88.832,400,80,400z"}))),Z=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:64,y:112,width:32,height:256}))),$=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:128,y:112,width:32,height:192}))),ee=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:192,y:112,width:32,height:192}))),te=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:256,y:112,width:32,height:256}))),ae=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:320,y:112,width:32,height:192}))),ne=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:384,y:112,width:32,height:256}))),re=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:128,y:336,width:32,height:32}))),ce=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:192,y:336,width:32,height:32}))),le=r.a.createElement("g",null,r.a.createElement("g",null,r.a.createElement("rect",{x:320,y:336,width:32,height:32}))),oe=r.a.createElement("g",null),ie=r.a.createElement("g",null),se=r.a.createElement("g",null),ue=r.a.createElement("g",null),de=r.a.createElement("g",null),me=r.a.createElement("g",null),he=r.a.createElement("g",null),pe=r.a.createElement("g",null),ge=r.a.createElement("g",null),fe=r.a.createElement("g",null),ve=r.a.createElement("g",null),Ee=r.a.createElement("g",null),be=r.a.createElement("g",null),ye=r.a.createElement("g",null),ke=r.a.createElement("g",null),Ce=function(e){var t=e.svgRef,a=e.title,n=q(e,["svgRef","title"]);return r.a.createElement("svg",F({id:"Capa_1",x:"0px",y:"0px",viewBox:"0 0 480 480",style:{enableBackground:"new 0 0 480 480"},xmlSpace:"preserve",ref:t},n),a?r.a.createElement("title",null,a):null,G,X,Q,Y,Z,$,ee,te,ae,ne,re,ce,le,oe,ie,se,ue,de,me,he,pe,ge,fe,ve,Ee,be,ye,ke)},we=r.a.forwardRef((function(e,t){return r.a.createElement(Ce,F({svgRef:t},e))})),je=(a.p,a(208)),Oe=a.n(je),xe=function(e){function t(e){var a;Object(E.a)(this,t),(a=Object(y.a)(this,Object(k.a)(t).call(this,e))).onTooltipClose=function(){a.props.dispatch("prefs/set",{key:"scan_tooltip_shown",value:!0}),a.setState({tooltip:!1})},a.onDone=function(e){a.setState({number:e.qr_data,error:!1})},a.onError=function(e){},a.onScanClick=function(e){!0!==a.props.prefs.scan_ios_tooltip_shown&&g.B===g.n?a.props.setModal(r.a.createElement(g.r,{activeModal:"modal"},r.a.createElement(g.q,{id:"modal",onClose:function(){return a.props.setModal(null)},icon:r.a.createElement(g.c,{type:"app",src:Oe.a,size:72}),title:"\u0427\u0442\u043e\u0431\u044b \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u043d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u043d\u0430 \u043d\u0438\u0436\u043d\u044e\u044e \u0447\u0430\u0441\u0442\u044c \u0440\u0430\u043c\u043a\u0438",caption:"\u041d\u0430\u0439\u0434\u0438\u0442\u0435 \u0445\u043e\u0440\u043e\u0448\u0435\u0435 \u043e\u0441\u0432\u0435\u0449\u0435\u043d\u0438\u0435",actions:[{title:"\u0411\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c",type:"secondary",action:function(){a.props.dispatch("prefs/set",{key:"scan_ios_tooltip_shown",value:!0}),a.props.setModal(null),a.scan(e)}},{title:"\u041f\u043e\u043d\u044f\u043b",type:"primary",action:function(){a.props.setModal(null),a.scan(e)}}]}))):a.scan(e)},a.scan=function(e){i.a.sendPromise("VKWebAppOpenQR").then(a.onDone).catch(a.onError)},a.onAddClick=function(){var e=a.state,t=e.name,n=e.number;if(a.isValidName(t)&&a.isValidCard(n)){a.setState({error:!1});var r=a.state.serviceId,c=a.props.user.uid;a.props.dispatch("cards/api/add",{uid:c,name:t,number:n,serviceId:r}),a.props.goHome()}else a.setState({error:!0})},a.onChangeText=function(e){var t=e.target.value.trim().substring(0,24).replace(/[^\x00-\x7F]/g,"");a.setState({number:t,error:!a.isValidCard(t)})};var n=e.args.number||"";return a.state={tooltip:!0!==e.prefs.scan_tooltip_shown,serviceId:e.args.serviceid,name:decodeURIComponent(e.args.name),number:n,error:!a.isValidCard(n),service:null},a}return Object(w.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({service:t.data.all.filter((function(t){return t.id===e.state.serviceId}))[0]})}))}},{key:"isValidName",value:function(e){return""!==e}},{key:"isValidCard",value:function(e){return null!=e&&e.match("^[\0-\x7f]{6,24}$")}},{key:"render",value:function(){var e=this,t=Object(g.B)();return r.a.createElement(g.s,{id:this.props.id},r.a.createElement(g.t,{left:r.a.createElement(g.m,{onClick:function(){return e.props.goBack()}},t===g.n?r.a.createElement(V.a,null):r.a.createElement(M.a,null))},"\u041d\u043e\u0432\u0430\u044f \u043a\u0430\u0440\u0442\u0430"),r.a.createElement(g.e,{style:{marginTop:10},before:null!=this.state.service&&null!=this.state.service.logo?r.a.createElement(g.c,{type:"image",src:"/BonusCards"+this.state.service.logo,style:{background:this.state.service.bgColor}}):r.a.createElement(g.c,{type:"image"},r.a.createElement(S.a,null))},this.state.name),r.a.createElement(g.j,null,r.a.createElement("div",null,r.a.createElement(g.z,{text:"\u041a\u0430\u0440\u0442\u0443 \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c",isShown:this.state.tooltip,alignX:"right",cornerOffset:-10,offsetX:-5,offsetY:5,onClose:this.onTooltipClose},r.a.createElement(g.o,{style:{paddingRight:56},autoFocus:!0,status:"default",onChange:this.onChangeText,value:this.state.number,type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u043a\u0430\u0440\u0442\u044b"})),r.a.createElement(we,{onClick:this.onScanClick,className:"Scan",width:30,height:30,fill:"var(--control_foreground)"}))),r.a.createElement(g.g,null,r.a.createElement(g.d,{disabled:!0===this.state.error,size:"xl",onClick:function(t){return e.onAddClick(t)}},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")))}}]),t}(r.a.Component),Se=p()("cards","prefs",xe),Ie=a(91),_e=Object(g.B)(),Be=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(y.a)(this,Object(k.a)(t).call(this,e))).state={search:"",services:[],popular:[]},a.onChange=a.onChange.bind(Object(C.a)(a)),a.cache=new Ie.c({fixedWidth:!0,defaultHeight:100}),a}return Object(w.a)(t,e),Object(b.a)(t,[{key:"onChange",value:function(e){this.setState({search:e.substring(0,40)})}},{key:"matchSearch",value:function(e,t){return e.toLowerCase().indexOf(t)>-1}},{key:"componentDidMount",value:function(){var e=this;fetch("./data.json").then((function(e){return e.json()})).then((function(t){return e.setState({services:t.data.all,popular:null})}))}},{key:"renderHeader",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.l,{level:"secondary"},"\u041f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u043e\u0435"),this.state.popular.map((function(t){return e.renderCard(t)})),r.a.createElement(g.l,{level:"secondary"},"\u0412\u0441\u0435"))}},{key:"renderRow",value:function(e,t,a,n){var c=this.services[e];return r.a.createElement(Ie.b,{key:t,cache:this.cache,parent:n,columnIndex:0,rowIndex:e},r.a.createElement("div",{key:t,style:a},this.renderCard(c)))}},{key:"renderCard",value:function(e){var t=this;return r.a.createElement(g.e,{before:"undefined"!==typeof e.logo&&null!=e.logo?r.a.createElement(g.c,{type:"image",src:"/BonusCards"+e.logo,style:{background:e.bgColor}}):r.a.createElement(g.c,{type:"image"},r.a.createElement(S.a,null)),expandable:!0,removable:!1,key:e.id,onClick:function(){t.props.goToPage("add",{name:e.name,serviceid:e.id})}},e.name)}},{key:"goBack",value:function(){window.history.back()}},{key:"render",value:function(){var e=this,t=this.props.id;return r.a.createElement(g.s,{id:t},r.a.createElement(g.t,{left:r.a.createElement(g.m,{onClick:this.goBack},_e===g.n?r.a.createElement(V.a,null):r.a.createElement(M.a,null))},r.a.createElement(g.w,{theme:"header",style:{paddingRight:_e===g.n?0:56},value:this.state.search,onChange:this.onChange,onClose:this.goBack})),0===this.state.services.length&&r.a.createElement(g.y,{size:"medium",style:{marginTop:20}}),r.a.createElement(Ie.a,null,(function(t){var a=t.height,n=t.width;return r.a.createElement(Ie.d,{width:n,height:a,deferredMeasurementCache:e.cache,rowHeight:e.cache.rowHeight,rowRenderer:function(t){var a=t.index,n=t.key,r=t.style,c=t.parent;return e.renderRow(a,n,r,c)},rowCount:e.services.length,overscanRowCount:3})})))}},{key:"services",get:function(){var e=this,t=this.state.search.toLowerCase().trim(),a=_()().transform(t),n=this.state.services.filter((function(n){return e.matchSearch(n.name,t)||e.matchSearch(n.name,a)||null!=n.keywords&&n.keywords.filter((function(n){return e.matchSearch(n,t)||e.matchSearch(n,a)})).length>0})).map((function(e){return e}));return t.length>0&&n.unshift({id:null,logo:null,name:t}),n.map((function(e){return e.name=e.name.charAt(0).toUpperCase()+e.name.slice(1),e}))}}]),t}(r.a.Component),Pe=a(90),Te=a.n(Pe);a(454),a(447),a(449);Te.a.initializeApp({apiKey:"AIzaSyCfEuUvuiEzVpUHg46vyWGPSISl4iyb2Mg",authDomain:"bonuscards-42f7a.firebaseapp.com",databaseURL:"https://bonuscards-42f7a.firebaseio.com",projectId:"bonuscards-42f7a",storageBucket:"bonuscards-42f7a.appspot.com",messagingSenderId:"774318858298",appId:"1:774318858298:web:0dc82b27bebdd8f1849503",measurementId:"G-HS7VBZ98KJ"}),Te.a.auth().onIdTokenChanged((function(e){return console.log("onIdTokenChanged")})),Te.a.analytics();var Ve=Te.a,Ae=a(214),Me=p()("cards",(function(e){var t=Object(n.useState)({name:"home",args:{}}),a=Object(m.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)([{name:"home",args:{}}]),s=Object(m.a)(o,2),h=s[0],p=(s[1],Object(n.useState)(null)),f=Object(m.a)(p,2),E=f[0],b=f[1],y=Object(n.useState)(null),k=Object(m.a)(y,2),C=k[0],w=k[1],j=Object(n.useState)(null),O=Object(m.a)(j,2),x=O[0],S=O[1],I=Object(n.useState)(null),_=Object(m.a)(I,2),B=_[0],T=_[1],V=Object(n.useRef)(E),A=function(){null!=V.current?b(null):1===h.length?i.a.send("VKWebAppClose"):h.length>1&&(h.pop(),l(h[h.length-1]),console.log("setActivePanel"+h[h.length-1].name))},M=function(e,t){window.history.pushState(t,e),h.push({name:e,args:t||{}}),l({name:e,args:t||{}})};return Object(n.useEffect)((function(){V.current=E}),[E]),Object(n.useEffect)((function(){window.addEventListener("popstate",(function(e){e.preventDefault(),A()}));var t=function(){var t=Object(d.a)(u.a.mark((function t(){var a,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://europe-west2-bonuscards-42f7a.cloudfunctions.net/token"+e.search);case 2:return a=t.sent,t.next=5,a.json();case 5:return n=t.sent,console.log("params checked"),t.next=9,Ve.auth().setPersistence(Ve.auth.Auth.Persistence.LOCAL);case 9:return console.log("signInWithCustomToken"),t.next=12,Ve.auth().signInWithCustomToken(n.token);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),a=function(t){S(t),e.dispatch("cards/listen",{uid:t.uid});var a=e.hash.slice(1).split("&").map((function(e){var t=e.split("=");return{key:t[0],value:t[1]}})).reduce((function(e,t){return e[t.key]=t.value,e}),{});null!=a.add_number&&null!=a.add_name&&M("add",{name:a.add_name,number:a.add_number,serviceid:a.add_service_id})};null!=Ve.auth().currentUser?a(Ve.auth().currentUser):Ve.auth().onAuthStateChanged((function(e){e?a(e):t().catch((function(e){T(e),console.log("auth error:"+e)}))}),(function(e){console.log(e)})),i.a.subscribe((function(e){if("VKWebAppViewRestore"===e.detail.type){var t=Ve.auth().currentUser;t&&a(t)}else"VKWebAppViewHide"===e.detail.type&&(console.log("terminate"),Ve.firestore().terminate())}))}),[]),r.a.createElement(g.f,{isWebView:!0},r.a.createElement(g.v,{activeView:null!=B?"error":!0===e.cards.loading?"splash":"main"},r.a.createElement(g.A,{id:"splash",activePanel:"splash"},r.a.createElement(g.s,{id:"splash"},r.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"75vh"}},r.a.createElement(g.y,{size:"large"})),r.a.createElement(g.h,{vertical:"bottom"},r.a.createElement(g.i,{className:"unselectable"},Ae.version)))),r.a.createElement(g.A,{id:"error",activePanel:"error"},r.a.createElement(g.s,{id:"error"},r.a.createElement(g.t,null,"\u0411\u043e\u043d\u0443\u0441 \u043a\u0430\u0440\u0442\u044b"),r.a.createElement(g.u,{icon:r.a.createElement(v.a,null)},"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437"))),r.a.createElement(g.A,{id:"main",activePanel:c.name,popout:E,modal:C,onSwipeBack:A},r.a.createElement(P,{id:"home",goToPage:M,user:x,args:c.args}),r.a.createElement(J,{id:"card",goToPage:M,goBack:A,setPopout:b,args:c.args}),r.a.createElement(Be,{id:"services",goToPage:M,goBack:A,args:c.args}),r.a.createElement(Se,{id:"add",goToPage:M,goBack:A,goHome:function(){h.length=0,h.push({name:"home",args:{}}),l({name:"home",args:{}})},args:c.args,user:x,setModal:w}))))})),ze=a(215),Re=a.n(ze),We=a(216),He=a.n(We),Ke=a(138),Le=a.n(Ke);i.a.subscribe((function(e){switch(console.log(e.detail.type),e.detail.type){case"VKWebAppUpdateConfig":var t=document.createAttribute("scheme");t.value=e.detail.data.scheme?e.detail.data.scheme:"client_light",document.body.attributes.setNamedItem(t);break;default:console.log(e.detail.type)}})),i.a.send("VKWebAppInit");var Ne=Re()([function(e){e.on("@init",(function(){return{cards:{loading:!0,data:[]}}})),e.on("cards/save",(function(e,t){var a=e.cards,n=t.cardsToSave;return a.data=n,a.loading=!1,console.log("update cards"),{cards:a}})),e.on("cards/listen",(function(t,a){t.cards;var n=a.uid;Ve.firestore().collection("cards").where("uid","==",n).onSnapshot({includeMetadataChanges:!0},(function(t){console.log(t),e.dispatch("cards/api/get",n)}))})),e.on("cards/api/get",(function(t,a){t.cards;Ve.firestore().collection("cards").where("uid","==",a).get().then((function(t){var a=t.docs.map((function(e){return{docId:e.id,uid:e.data().uid,id:e.data().id,name:e.data().name,number:e.data().number,serviceId:e.data().service_id}}));e.dispatch("cards/save",{cardsToSave:a})})).catch((function(e){console.log("error get cards from firebase:"+e)}))})),e.on("cards/api/add",(function(e,t){e.cards;var a=Ve.firestore();t.id=function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*n));return t}(20),a.collection("cards").add({uid:t.uid,id:t.id,name:t.name,number:t.number,service_id:t.serviceId})})),e.on("cards/api/delete",(function(e,t){e.cards;Ve.firestore().collection("cards").doc(t.docId).delete()}))},function(e){e.on("@init",(function(){return{prefs:{}}})),e.on("prefs/set",(function(e,t){var a=e.prefs;return a[t.key]=t.value,a}))},He()(["prefs"])]),Ue=window.location.search,De=window.location.hash;l.a.render(r.a.createElement(Le.a.Provider,{value:Ne},r.a.createElement(Me,{search:Ue,hash:De})),document.getElementById("root"))},96:function(e,t,a){}},[[262,1,2]]]);
//# sourceMappingURL=main.af3dcc9a.chunk.js.map